<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Addrbook">

	<sql id="getPrivateAddress_Where_Clause" >
		<isEqual property="name" compareValue="all">
   		<![CDATA[
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ㄱ">
   		<![CDATA[
   		and ((substr(a.member_name,1,1) = #name#) or (substr(a.member_name,1,1) >= '가' and substr(a.member_name,1,1) < '나'))
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ㄴ">
   		<![CDATA[
   		and ((substr(a.member_name,1,1) = #name#) or (substr(a.member_name,1,1) >= '나' and substr(a.member_name,1,1) < '다'))
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ㄷ">
   		<![CDATA[
   		and ((substr(a.member_name,1,1) = #name#) or (substr(a.member_name,1,1) >= '다' and substr(a.member_name,1,1) < '라'))
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ㄹ">
   		<![CDATA[
   		and ((substr(a.member_name,1,1) = #name#) or (substr(a.member_name,1,1) >= '라' and substr(a.member_name,1,1) < '마'))
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ㅁ">
   		<![CDATA[
   		and ((substr(a.member_name,1,1) = #name#) or (substr(a.member_name,1,1) >= '마' and substr(a.member_name,1,1) < '바'))
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ㅂ">
   		<![CDATA[
   		and ((substr(a.member_name,1,1) = #name#) or (substr(a.member_name,1,1) >= '바' and substr(a.member_name,1,1) < '사'))
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ㅅ">
   		<![CDATA[
   		and ((substr(a.member_name,1,1) = #name#) or (substr(a.member_name,1,1) >= '사' and substr(a.member_name,1,1) < '아'))
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ㅇ">
   		<![CDATA[
   		and ((substr(a.member_name,1,1) = #name#) or (substr(a.member_name,1,1) >= '아' and substr(a.member_name,1,1) < '자'))
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ㅈ">
   		<![CDATA[
   		and ((substr(a.member_name,1,1) = #name#) or (substr(a.member_name,1,1) >= '자' and substr(a.member_name,1,1) < '차'))
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ㅊ">
   		<![CDATA[
   		and ((substr(a.member_name,1,1) = #name#) or (substr(a.member_name,1,1) >= '차' and substr(a.member_name,1,1) < '카'))
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ㅋ">
   		<![CDATA[
   		and ((substr(a.member_name,1,1) = #name#) or (substr(a.member_name,1,1) >= '카' and substr(a.member_name,1,1) < '타'))
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ㅌ">
   		<![CDATA[
   		and ((substr(a.member_name,1,1) = #name#) or (substr(a.member_name,1,1) >= '타' and substr(a.member_name,1,1) < '파'))
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ㅍ">
   		<![CDATA[
   		and ((substr(a.member_name,1,1) = #name#) or (substr(a.member_name,1,1) >= '파' and substr(a.member_name,1,1) < '하'))
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ㅎ">
   		<![CDATA[
   		and ((substr(a.member_name,1,1) = #name#) or (substr(a.member_name,1,1) >= '하' and substr(a.member_name,1,1) <= '힣'))
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="0-9">
   		<![CDATA[
   		and substr(a.member_name,1,1) >= '0' and substr(a.member_name,1,1) <= '9'
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="あ">
   		<![CDATA[
   		and substr(a.member_name,1,1) in (#name1#, #name2#, #name3#, #name4#, #name5#)
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="か">
   		<![CDATA[
   		and substr(a.member_name,1,1) in (#name6#, #name7#, #name8#, #name9#, #name10#)
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="さ">
   		<![CDATA[
   		and substr(a.member_name,1,1) in (#name11#, #name12#, #name13#, #name14#, #name15#)
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="た">
   		<![CDATA[
   		and substr(a.member_name,1,1) in (#name16#, #name17#, #name18#, #name19#, #name20#)
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="な">
   		<![CDATA[
   		and substr(a.member_name,1,1) in (#name21#, #name22#, #name23#, #name24#, #name25#)
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="は">
   		<![CDATA[
   		and substr(a.member_name,1,1) in (#name26#, #name27#, #name28#, #name29#, #name30#)
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ま">
   		<![CDATA[
   		and substr(a.member_name,1,1) in (#name31#, #name32#, #name33#, #name34#, #name35#)
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="や">
   		<![CDATA[
   		and substr(a.member_name,1,1) in (#name36#, #name37#, #name38#)
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="ら">
   		<![CDATA[
   		and substr(a.member_name,1,1) in (#name39#, #name40#, #name41#, #name42#, #name43#)
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="わ">
   		<![CDATA[
   		and substr(a.member_name,1,1) in (#name44#, #name45#)
   		]]>
   		</isEqual>
   		
   		<isEqual property="name" compareValue="a-z">
   		<![CDATA[
   		and substr(a.member_name,1,1) >= 'a' and substr(a.member_name,1,1) <= 'z'
   		]]>
   		</isEqual>
   		
   		<isNotEqual property="name" compareValue="all">
   			<isNotEqual property="name" compareValue="a-z">
		   		<isGreaterEqual property="name" compareValue="a">
		   			<isLessEqual property="name" compareValue="z">
		   				<![CDATA[
		   				and substr(a.member_name,1,1) = #name#
		   				]]>
		   			</isLessEqual>
		   		</isGreaterEqual>
	   		</isNotEqual>
   		</isNotEqual>
   		
	</sql>
	<sql id="getPrivateAddress_Order_Clause" >
		<isEqual property="sortBy" compareValue="name">
   		<![CDATA[
   			order by a.member_name 
   		]]>
   		</isEqual>
   		
   		<isEqual property="sortBy" compareValue="email">
   		<![CDATA[
   			order by a.member_email 
   		]]>
   		</isEqual>
   		
   		<isEqual property="sortBy" compareValue="mobile">
   		<![CDATA[
   			order by a.mobile_no 
   		]]>
   		</isEqual>
   		
   		<isEqual property="sortBy" compareValue="company">
   		<![CDATA[
   			order by a.company_name 
   		]]>
   		</isEqual>
   		
   		<isEqual property="sortBy" compareValue="seq">
   		<![CDATA[
   			order by a.member_seq 
   		]]>
   		</isEqual>
   		
   		<isEqual property="sortDir" compareValue="asc">
   		<![CDATA[
   			asc 
   		]]>
   		</isEqual>
   		
   		<isEqual property="sortDir" compareValue="desc">
   		<![CDATA[
   			desc 
   		]]>
   		</isEqual>
   		
	</sql>
	<select id="getPrivateGroupList" resultClass="group" parameterClass="int">
	    SELECT
	      group_seq as groupSeq,
	      group_name as groupName
	    FROM adr_private_group
	    	WHERE mail_user_seq = cast(#value# as INT)
	</select>
	
	<select id="getPrivateGroupCount" resultClass="int" parameterClass="int">
	    SELECT
	      count(group_seq)
	    FROM adr_private_group
	    	WHERE mail_user_seq = cast(#value# as INT)
	</select>
  
	<select id="getPrivateMember" resultMap="addrbookMemberResult" parameterClass="Map">
	    SELECT
	      *
	    FROM adr_private_member
	    WHERE
	    	mail_user_seq = cast(#userSeq# as INT) 
	    	and member_seq = cast(#memberSeq# as INT)
	</select>
  
	<select id="getLastInsertMember" resultMap="addrbookMemberResult" parameterClass="int">
    SELECT
      *
    FROM adr_private_member
    WHERE
    	MAIL_USER_SEQ = cast(#value# as INT)
    	and member_seq in (select max(member_seq) from adr_private_member where MAIL_USER_SEQ = cast(#value# as INT))
	</select>
	
	<select id="getPrivateAddressList" resultMap="addrbookMemberResult" parameterClass="Map">
    SELECT
      a.*
    FROM adr_private_member a
    WHERE 
    	a.mail_user_seq = cast(#user# as INT)
    	<dynamic prepend="">
    		<isParameterPresent >
    		  and (delete_flag is null or delete_flag='' )
		      <include refid="getPrivateAddress_Where_Clause" />
		      <include refid="getPrivateAddress_Order_Clause" />
		    </isParameterPresent>
    	</dynamic>
    	
		 limit #maxResult# offset #skipResult#
	</select>
	
	<select id="getPrivateAddressListCount" resultClass="int" parameterClass="Map">
    SELECT
      count(a.member_seq)
    FROM adr_private_member a
    WHERE 
    	a.mail_user_seq = cast(#user# as INT)
    	<dynamic prepend=" ">
    		<isParameterPresent >
    		  and (delete_flag is null or delete_flag='' )
		      <include refid="getPrivateAddress_Where_Clause" />
		    </isParameterPresent>
    	</dynamic>
	</select>
  
	<select id="getPrivateAddressListByGroup" resultMap="addrbookMemberResult" parameterClass="Map">
    SELECT
      a.*
    FROM adr_private_member a, adr_private_group_member b
    WHERE 
    	a.member_seq=b.member_seq
    	and a.mail_user_seq = b.mail_user_seq
    	and a.mail_user_seq = cast(#user# as INT) 
    	and b.group_seq = cast(#groupSeq# as INT)
    	<dynamic prepend=" ">
    		<isParameterPresent >
    		  and (delete_flag is null or delete_flag='' )
		      <include refid="getPrivateAddress_Where_Clause" />
		      <include refid="getPrivateAddress_Order_Clause" />
		    </isParameterPresent>
    	</dynamic>
    	
    	limit #maxResult# offset #skipResult#
	</select>
	
	<select id="getPrivateAddressListByGroupCount" resultClass="int" parameterClass="Map">
    SELECT
      count(a.member_seq)
    FROM adr_private_member a, adr_private_group_member b
    WHERE 
    	a.member_seq=b.member_seq
    	and a.mail_user_seq = b.mail_user_seq
    	and a.mail_user_seq = cast(#user# as INT) 
    	and b.group_seq = cast(#groupSeq# as INT)
    	<dynamic prepend=" ">
    		<isParameterPresent >
    		  and (delete_flag is null or delete_flag='' )
		      <include refid="getPrivateAddress_Where_Clause" />
		    </isParameterPresent>
    	</dynamic>
	</select>
  
	<insert id="insertPrivateMember" parameterClass="member">
  		<selectKey resultClass="int" keyProperty="memberSeq">
			select case when max(MEMBER_SEQ) is null then 1 else max(MEMBER_SEQ)+1 end
			from adr_private_member where MAIL_USER_SEQ = cast(#userSeq# as INT)
		</selectKey>
  		insert into ADR_PRIVATE_MEMBER 
  		(
  			MAIL_USER_SEQ, MEMBER_SEQ, MEMBER_EMAIL, MEMBER_NAME, FIRST_NAME, 
  			MIDDLE_NAME, LAST_NAME, NICK_NAME, PRIVATE_HOMEPAGE, OFFICE_HOMEPAGE, 
  			BIRTH_DAY,ANNIVERSARY_DAY, MOBILE_NO, HOME_TEL, HOME_FAX, 
  			HOME_POSTAL_CODE, HOME_COUNTRY, HOME_STATE, HOME_CITY, HOME_STREET, 
  			HOME_BASIC_ADDRESS, HOME_EXT_ADDRESS, COMPANY_NAME, DEPARTMENT_NAME, TITLE_NAME, 
  			OFFICE_TEL, OFFICE_FAX, OFFICE_POSTAL_CODE, OFFICE_COUNTRY, OFFICE_STATE,
      		OFFICE_STREET, OFFICE_BASIC_ADDRESS, OFFICE_EXT_ADDRESS, OFFICE_CITY, CLIENT_ID, ADD_TIME
      	)
    	values 
    	(
    		cast(#userSeq# as INT), cast(#memberSeq:INTEGER# as INT), #memberEmail:VARCHAR#, #memberName:VARCHAR#, #firstName:VARCHAR#, 
    		#middleName:VARCHAR#, #lastName:VARCHAR#, #nickName:VARCHAR#, #privateHomepage:VARCHAR#, #officeHomepage:VARCHAR#, 
    		#birthDay:VARCHAR#, #anniversaryDay:VARCHAR#, #mobileNo:VARCHAR#, #homeTel:VARCHAR#, #homeFax:VARCHAR#,
      		#homePostalCode:VARCHAR#, #homeCountry:VARCHAR#, #homeState:VARCHAR#, #homeCity:VARCHAR#, #homeStreet:VARCHAR#, 
      		#homeBasicAddress:VARCHAR#, #homeExtAddress:VARCHAR#, #companyName:VARCHAR#, #departmentName:VARCHAR#, #titleName:VARCHAR#, 
      		#officeTel:VARCHAR#, #officeFax:VARCHAR#, #officePostalCode:VARCHAR#, #officeCountry:VARCHAR#, #officeState:VARCHAR#, 
      		#officeStreet:VARCHAR#, #officeBasicAddress:VARCHAR#,#officeExtAddress:VARCHAR#, #officeCity:VARCHAR#, 
      		#clientId:VARCHAR#, #addTime:VARCHAR#
      	)
	</insert>
  
	<update id="updatePrivateMember" parameterClass="member">
  		update ADR_PRIVATE_MEMBER
	    set MEMBER_EMAIL = #memberEmail:VARCHAR#,
	      MEMBER_NAME = #memberName:VARCHAR#,
	      FIRST_NAME = #firstName:VARCHAR#,
	      MIDDLE_NAME = #middleName:VARCHAR#,
	      LAST_NAME = #lastName:VARCHAR#,
	      NICK_NAME = #nickName:VARCHAR#,
	      PRIVATE_HOMEPAGE = #privateHomepage:VARCHAR#,
	      OFFICE_HOMEPAGE = #officeHomepage:VARCHAR#,
	      BIRTH_DAY = #birthDay:VARCHAR#,
	      ANNIVERSARY_DAY = #anniversaryDay:VARCHAR#,
	      MOBILE_NO = #mobileNo:VARCHAR#,
	      HOME_TEL = #homeTel:VARCHAR#,
	      HOME_FAX = #homeFax:VARCHAR#,
	      HOME_POSTAL_CODE = #homePostalCode:VARCHAR#,
	      HOME_COUNTRY = #homeCountry:VARCHAR#,
	      HOME_STATE = #homeState:VARCHAR#,
	      HOME_CITY = #homeCity:VARCHAR#,
	      HOME_STREET = #homeStreet:VARCHAR#,
	      HOME_BASIC_ADDRESS = #homeBasicAddress:VARCHAR#,
	      HOME_EXT_ADDRESS = #homeExtAddress:VARCHAR#,
	      COMPANY_NAME = #companyName:VARCHAR#,
	      DEPARTMENT_NAME = #departmentName:VARCHAR#,
	      TITLE_NAME = #titleName:VARCHAR#,
	      OFFICE_TEL = #officeTel:VARCHAR#,
	      OFFICE_FAX = #officeFax:VARCHAR#,
	      OFFICE_POSTAL_CODE = #officePostalCode:VARCHAR#,
	      OFFICE_COUNTRY = #officeCountry:VARCHAR#,
	      OFFICE_STATE = #officeState:VARCHAR#,
	      OFFICE_STREET = #officeStreet:VARCHAR#,
	      OFFICE_BASIC_ADDRESS = #officeBasicAddress:VARCHAR#,
	      OFFICE_EXT_ADDRESS = #officeExtAddress:VARCHAR#,
	      OFFICE_CITY = #officeCity:VARCHAR#,
	      
	      MOD_TIME = #modTime:VARCHAR#
	    where MAIL_USER_SEQ = cast(#userSeq# as INT)
	      and MEMBER_SEQ = cast(#memberSeq:INTEGER# as INT)
	</update>
	
	<delete id="deleteCompletlyPrivateMember" parameterClass="Map" >
		delete from ADR_PRIVATE_MEMBER
		where 
			MAIL_USER_SEQ = cast(#userSeq# as INT)
      		and MEMBER_SEQ = cast(#memberSeq:INTEGER# as INT)
	</delete>
	
	<delete id="deletePrivateMember" parameterClass="Map" >
		update ADR_PRIVATE_MEMBER
	    set delete_flag = 'Y',del_time = #delTime#
	    where MAIL_USER_SEQ = cast(#userSeq# as INT)
	      and MEMBER_SEQ = cast(#memberSeq# as INT)
	</delete>
  
	<insert id="insertPrivateGroupMemberRelation" parameterClass="groupMemberRelation" >
    	insert into ADR_PRIVATE_GROUP_MEMBER 
    		(GROUP_SEQ, MAIL_USER_SEQ, MEMBER_SEQ)
    	values (cast(#groupSeq# as INT), cast(#mailUserSeq# as INT), cast(#memberSeq# as INT))
	</insert>
	
	<select id="getPrivateMembers" resultMap="addrbookMemberResult" parameterClass="int">
    	SELECT
     	 *
   		FROM adr_private_member
    	WHERE mail_user_seq=cast(#value# as INT)
  	</select>
  	
  	<insert id="insertPrivateGroup" parameterClass="group" >
		<selectKey resultClass="int" keyProperty="groupSeq">
			select case when max(group_seq) is null then 1 else max(group_seq)+1 end
			from adr_private_group
		</selectKey>
		insert into adr_private_group (mail_user_seq, group_seq, group_name ) values (cast(#userSeq# as INT), cast(#groupSeq# as INT), #groupName#)
	</insert>
	
	<update id="updatePrivateGroup" parameterClass="group" >
		update ADR_PRIVATE_GROUP
	    	set GROUP_NAME = #groupName:VARCHAR#
	    where GROUP_SEQ = cast(#groupSeq:INTEGER# as INT)
	      and MAIL_USER_SEQ = cast(#userSeq:INTEGER# as INT)
	</update>
  
	<delete id="deletePrivateGroup" parameterClass="Map" >
	    delete from ADR_PRIVATE_GROUP
	    where GROUP_SEQ = cast(#groupSeq# as INT)
	      and MAIL_USER_SEQ = cast(#userSeq# as INT)
	</delete>
	
	<select id="getSharedAddressBookAllListWithAuth" resultMap="addrbookWithAuthResult" parameterClass="map">
		SELECT 
			a.adrbook_seq,
			a.mail_domain_seq,
			a.adrbook_name,    	
			a.reader_type,
			a.description,
			a.creator_seq,
			b.user_name,
			(select count(r.mail_user_seq) from adr_shared_reader r where r.adrbook_seq=a.adrbook_seq and r.mail_user_seq=cast(#userSeq# as INT)) as readAuth,
			(select count(w.mail_user_seq) from adr_shared_moderator w where w.adrbook_seq=a.adrbook_seq and w.mail_user_seq=cast(#userSeq# as INT)) as writeAuth
		FROM 
			ADR_SHARED_MASTER a, mail_user_info b
		where 
			a.CREATOR_SEQ = b.mail_user_seq
			and a.mail_domain_seq=cast(#domainSeq# as INT)
			and a.adrbook_seq 	 in(
			 	select a.adrbook_seq from adr_shared_reader a where a.mail_user_seq=cast(#userSeq# as INT)
				union
				select a.adrbook_seq from adr_shared_moderator a where a.mail_user_seq=cast(#userSeq# as INT)
				union
				select a.adrbook_seq from ADR_SHARED_MASTER a where a.creator_seq=cast(#userSeq# as INT)
				
				union
				select a.adrbook_seq from ADR_SHARED_MASTER a where a.reader_type='A'
				
			 )
			 
  	</select>
  	
  	<insert id="insertSharedAddressBook" parameterClass="addrbook" >
    	insert into ADR_SHARED_MASTER 
    		(MAIL_DOMAIN_SEQ, ADRBOOK_NAME, CREATOR_SEQ,
      			READER_TYPE, DESCRIPTION)
    	values 
    		(cast(#mailDomainSeq# as INT), #addrbookName#, cast(#creatorSeq# as INT), 
    			#readerType#, #description#)
  	</insert>
  	
  	<delete id="deleteSharedAddressBook" parameterClass="int" >
		delete from ADR_SHARED_MASTER where ADRBOOK_SEQ = cast(#value# as INT)
	</delete>
	
	<update id="updateSharedAddressBook" parameterClass="addrbook" >
    	update ADR_SHARED_MASTER
    	set 
      		ADRBOOK_NAME = #addrbookName#
    	where 
    		ADRBOOK_SEQ = cast(#addrbookSeq# as INT)
	</update>
	
	<update id="updateReaderType" parameterClass="Map" >
    	update ADR_SHARED_MASTER
    	set 
			READER_TYPE = #readerType#
    	where 
    		ADRBOOK_SEQ = cast(#addrbookSeq# as INT)
	</update>
  	
  	<select id="getSharedGroup" parameterClass="map" resultClass="group">
	    SELECT
	      group_seq as groupSeq,
	      group_name as groupName
	    FROM adr_shared_group
	    WHERE adrbook_seq=cast(#bookSeq# as INT)
	    and group_seq = cast(#groupSeq# as INT)
	</select>
  	
  	<select id="getSharedGroupList" parameterClass="int" resultClass="group">
	    SELECT
	      group_seq as groupSeq,
	      group_name as groupName
	    FROM adr_shared_group
	    WHERE adrbook_seq=cast(#value# as INT)
	</select>
	
	<select id="getSharedGroupCount" parameterClass="int" resultClass="int">
	    SELECT
	      count(group_seq)
	    FROM adr_shared_group
	    	WHERE ADRBOOK_SEQ =cast(#value# as INT)
	</select>
	
	<insert id="insertSharedGroup" parameterClass="group" >
		<selectKey resultClass="int" keyProperty="groupSeq">
			select
				case when max(GROUP_SEQ) is null then 1 else max(GROUP_SEQ)+1 end as groupSeq
			from ADR_SHARED_GROUP
		</selectKey>
		insert into ADR_SHARED_GROUP (ADRBOOK_SEQ, GROUP_SEQ, GROUP_NAME)
		values (cast(#adrbookSeq# as INT), cast(#groupSeq# as INT), #groupName#)
	</insert>
	
	<update id="updateSharedGroup" parameterClass="group" >
    	update ADR_SHARED_GROUP
    		set GROUP_NAME = #groupName:VARCHAR#
    	where 
    		ADRBOOK_SEQ = cast(#adrbookSeq:INTEGER# as INT)
      		and GROUP_SEQ = cast(#groupSeq:INTEGER# as INT)
	</update>
	
	<delete id="deleteSharedGroup" parameterClass="Map" >
		delete from ADR_SHARED_GROUP
		where 
			ADRBOOK_SEQ = cast(#adrbookSeq# as INT)
      		and GROUP_SEQ = cast(#groupSeq# as INT)
	</delete>
	
	<select id="getSharedAddressList" resultMap="addrbookSharedMemberResult" parameterClass="Map">
    SELECT
      a.*,
      '' as ADD_TIME,
 	  '' as MOD_TIME,
      '' as DEL_TIME
    FROM adr_shared_member a
    WHERE 
    	a.adrbook_seq=cast(#book# as INT)
    	<dynamic prepend=" ">
    		<isParameterPresent >
		      <include refid="getPrivateAddress_Where_Clause" />
		      <include refid="getPrivateAddress_Order_Clause" />
		    </isParameterPresent>
    	</dynamic>
    	
    	limit #maxResult# offset #skipResult#
	</select>
	
	<select id="getSharedAddressListCount" resultClass="int" parameterClass="Map">
    SELECT
      count(a.member_seq)
    FROM adr_shared_member a
    WHERE 
    	a.adrbook_seq=cast(#book# as INT)
    	<dynamic prepend=" ">
    		<isParameterPresent >
		      <include refid="getPrivateAddress_Where_Clause" />
		    </isParameterPresent>
    	</dynamic>
	</select>
  
	<select id="getSharedAddressListByGroupCount" resultClass="int" parameterClass="Map">
    SELECT
      count(a.member_seq)
    FROM adr_shared_member a, adr_shared_group_member b
    WHERE a.member_seq=b.member_seq
    	and a.adrbook_seq=cast(#book# as INT)
    	and a.adrbook_seq=b.adrbook_seq
    	and b.group_seq = cast(#groupSeq# as INT) 
    	<dynamic prepend=" ">
    		<isParameterPresent >
		      <include refid="getPrivateAddress_Where_Clause" />
		    </isParameterPresent>
    	</dynamic>
	</select>
	
	<select id="getSharedAddressListByGroup" resultMap="addrbookSharedMemberResult" parameterClass="Map">
    SELECT
      a.*,
      '' as ADD_TIME,
 	  '' as MOD_TIME,
      '' as DEL_TIME
    FROM adr_shared_member a, adr_shared_group_member b
    WHERE a.member_seq=b.member_seq
    	and a.adrbook_seq=cast(#book# as INT) 
    	and a.adrbook_seq=b.adrbook_seq
    	and b.group_seq = cast(#groupSeq# as INT) 
    	<dynamic prepend=" ">
    		<isParameterPresent >
		      <include refid="getPrivateAddress_Where_Clause" />
		      <include refid="getPrivateAddress_Order_Clause" />
		    </isParameterPresent>
    	</dynamic>
    	
    	limit #maxResult# offset #skipResult#
	</select>
	
	<insert id="insertSharedMember" parameterClass="member">
  		<selectKey resultClass="int" keyProperty="memberSeq">
			select case when max(MEMBER_SEQ) is null then 1 else max(MEMBER_SEQ)+1 end
			from adr_shared_member where ADRBOOK_SEQ = cast(#addrbookSeq# as INT)
		</selectKey>
  		insert into ADR_SHARED_MEMBER 
  		(   ADRBOOK_SEQ, MEMBER_SEQ, MEMBER_EMAIL, MEMBER_NAME, FIRST_NAME, 
      		MIDDLE_NAME, LAST_NAME, NICK_NAME, PRIVATE_HOMEPAGE, OFFICE_HOMEPAGE, 
      		BIRTH_DAY, ANNIVERSARY_DAY, MOBILE_NO, HOME_TEL, HOME_FAX, 
      		HOME_POSTAL_CODE, HOME_COUNTRY, HOME_STATE, HOME_CITY, HOME_STREET, 
      		HOME_BASIC_ADDRESS, HOME_EXT_ADDRESS, COMPANY_NAME, DEPARTMENT_NAME,  TITLE_NAME, 
      		OFFICE_TEL, OFFICE_FAX, OFFICE_POSTAL_CODE, OFFICE_COUNTRY, OFFICE_STATE, 
      		OFFICE_STREET, OFFICE_BASIC_ADDRESS, OFFICE_EXT_ADDRESS, OFFICE_CITY
      	)
    	values 
    	(	cast(#addrbookSeq# as INT), cast(#memberSeq:INTEGER# as INT), #memberEmail:VARCHAR#, #memberName#,
			#firstName:VARCHAR#, #middleName:VARCHAR#, #lastName:VARCHAR#, #nickName:VARCHAR#,
			#privateHomepage:VARCHAR#, #officeHomepage:VARCHAR#, #birthDay:VARCHAR#,
			#anniversaryDay:VARCHAR#, #mobileNo:VARCHAR#, #homeTel:VARCHAR#, #homeFax:VARCHAR#,
			#homePostalCode:VARCHAR#, #homeCountry:VARCHAR#, #homeState:VARCHAR#, #homeCity:VARCHAR#,
			#homeStreet:VARCHAR#, #homeBasicAddress:VARCHAR#, #homeExtAddress:VARCHAR#,
			#companyName:VARCHAR#, #departmentName:VARCHAR#, #titleName:VARCHAR#, #officeTel:VARCHAR#,
			#officeFax:VARCHAR#, #officePostalCode:VARCHAR#, #officeCountry:VARCHAR#,
			#officeState:VARCHAR#, #officeStreet:VARCHAR#, #officeBasicAddress:VARCHAR#,
			#officeExtAddress:VARCHAR#, #officeCity:VARCHAR#
		)
	</insert>
	
	<update id="updateSharedMember" parameterClass="member" >
	    update ADR_SHARED_MEMBER
	    <dynamic prepend="set" >
	      <isNotNull prepend="," property="memberEmail" >
	        MEMBER_EMAIL = #memberEmail:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="memberName" >
	        MEMBER_NAME = #memberName:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="firstName" >
	        FIRST_NAME = #firstName:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="middleName" >
	        MIDDLE_NAME = #middleName:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="lastName" >
	        LAST_NAME = #lastName:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="nickName" >
	        NICK_NAME = #nickName:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="privateHomepage" >
	        PRIVATE_HOMEPAGE = #privateHomepage:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="officeHomepage" >
	        OFFICE_HOMEPAGE = #officeHomepage:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="birthDay" >
	        BIRTH_DAY = #birthDay:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="anniversaryDay" >
	        ANNIVERSARY_DAY = #anniversaryDay:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="mobileNo" >
	        MOBILE_NO = #mobileNo:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="homeTel" >
	        HOME_TEL = #homeTel:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="homeFax" >
	        HOME_FAX = #homeFax:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="homePostalCode" >
	        HOME_POSTAL_CODE = #homePostalCode:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="homeCountry" >
	        HOME_COUNTRY = #homeCountry:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="homeState" >
	        HOME_STATE = #homeState:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="homeCity" >
	        HOME_CITY = #homeCity:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="homeStreet" >
	        HOME_STREET = #homeStreet:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="homeBasicAddress" >
	        HOME_BASIC_ADDRESS = #homeBasicAddress:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="homeExtAddress" >
	        HOME_EXT_ADDRESS = #homeExtAddress:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="companyName" >
	        COMPANY_NAME = #companyName:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="departmentName" >
	        DEPARTMENT_NAME = #departmentName:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="titleName" >
	        TITLE_NAME = #titleName:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="officeTel" >
	        OFFICE_TEL = #officeTel:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="officeFax" >
	        OFFICE_FAX = #officeFax:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="officePostalCode" >
	        OFFICE_POSTAL_CODE = #officePostalCode:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="officeCountry" >
	        OFFICE_COUNTRY = #officeCountry:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="officeState" >
	        OFFICE_STATE = #officeState:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="officeStreet" >
	        OFFICE_STREET = #officeStreet:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="officeBasicAddress" >
	        OFFICE_BASIC_ADDRESS = #officeBasicAddress:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="officeExtAddress" >
	        OFFICE_EXT_ADDRESS = #officeExtAddress:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="officeCity" >
	        OFFICE_CITY = #officeCity:VARCHAR#
	      </isNotNull>
	      <isNotNull prepend="," property="description" >
	        DESCRIPTION = #description:LONGVARCHAR#
	      </isNotNull>
	    </dynamic>
	    where ADRBOOK_SEQ = cast(#addrbookSeq:INTEGER# as INT)
	      and MEMBER_SEQ = cast(#memberSeq:INTEGER# as INT)
	</update>
	
	<select id="getLastInsertSharedMember" resultMap="addrbookSharedMemberResult" parameterClass="int">
    SELECT
      *
    FROM adr_shared_member
    WHERE member_seq = (select max(member_seq) from adr_shared_member where adrbook_seq = cast(#value# as INT))
    	and adrbook_seq = cast(#value# as INT)
	</select>
	
	<insert id="insertSharedGroupMemberRelation" parameterClass="groupMemberRelation" >
    	insert into ADR_SHARED_GROUP_MEMBER 
    		(ADRBOOK_SEQ, GROUP_SEQ, MEMBER_SEQ)
    	values (cast(#bookSeq# as INT), cast(#groupSeq# as INT), cast(#memberSeq# as INT))
	</insert>
	
	<select id="getSharedMembers" resultMap="addrbookSharedMemberResult" parameterClass="int">
    	SELECT
     	 *
   		FROM adr_shared_member
    	WHERE adrbook_seq = cast(#value# as INT)
  	</select>
  	
  	<delete id="deleteSharedMember" parameterClass="Map" >
	    delete from ADR_SHARED_MEMBER
	    where ADRBOOK_SEQ = cast(#bookSeq# as INT)
	      and MEMBER_SEQ = cast(#memberSeq# as INT)
	</delete>
	
	<delete id="deletePrivateGroupMemberRelation" parameterClass="Map" >
    	delete from ADR_PRIVATE_GROUP_MEMBER
    	where 
      		MAIL_USER_SEQ = cast(#userSeq# as INT)
      		and MEMBER_SEQ = cast(#memberSeq# as INT)
      		and GROUP_SEQ = cast(#groupSeq# as INT)
  	</delete>
  	
  	<delete id="deletePrivateGroupMemberRelationAll" parameterClass="Map" >
    	delete from ADR_PRIVATE_GROUP_MEMBER
    	where 
      		MAIL_USER_SEQ = cast(#userSeq# as INT)
      		and MEMBER_SEQ = cast(#memberSeq# as INT)
  	</delete>
  	
  	<delete id="deleteSharedGroupMemberRelation" parameterClass="Map" >
    	delete from ADR_SHARED_GROUP_MEMBER
    	where 
      		ADRBOOK_SEQ = cast(#bookSeq# as INT)
      		and GROUP_SEQ = cast(#groupSeq# as INT)
	      	and MEMBER_SEQ = cast(#memberSeq# as INT)
  	</delete>
  	
  	<delete id="deleteSharedGroupMemberRelationAll" parameterClass="Map" >
    	delete from ADR_SHARED_GROUP_MEMBER
    	where 
      		ADRBOOK_SEQ = cast(#bookSeq# as INT)
	      	and MEMBER_SEQ = cast(#memberSeq# as INT)
  	</delete>
  	
  	<select id="getSharedMember" resultMap="addrbookSharedMemberResult" parameterClass="Map">
	    SELECT
	      *
	    FROM adr_shared_member
	    WHERE ADRBOOK_SEQ = cast(#bookSeq# as INT)
	      and MEMBER_SEQ = cast(#memberSeq# as INT)
	</select>
	
	<select id="getSharedAddressBookReaderListCount" resultClass="int" parameterClass="Map">
	    SELECT
	    	count(a.mail_user_seq)    	
	    FROM adr_shared_reader a, mail_user_info b, mail_user c
	    WHERE 
	    	a.mail_user_seq = b.mail_user_seq
	    	and a.mail_user_seq = c.mail_user_seq
	    	and a.adrbook_seq=cast(#bookSeq# as INT)
	    	<dynamic>
	    		<isNotNull property="searchType" prepend="and">
	  				<isEqual property="searchType" compareValue="uid">
	  					c.mail_uid like #keyWord#
	  				</isEqual>
  				</isNotNull>
	    	</dynamic>
	</select>
	
	<select id="getSharedAddressBookReaderList" resultMap="addrbookReaderResult" parameterClass="Map">
	    SELECT
	    	a.mail_user_seq,
	    	a.adrbook_seq,
	    	b.user_name,
	    	c.mail_uid || '@' || d.mail_domain as user_email,
	    	a.description    	
	    FROM adr_shared_reader a, mail_user_info b, mail_user c, mail_domain d
	    WHERE 
	    	a.mail_user_seq = b.mail_user_seq
	    	and a.mail_user_seq = c.mail_user_seq
	    	and c.mail_domain_seq = d.mail_domain_seq
	    	and a.adrbook_seq=cast(#bookSeq# as INT)
	    	<dynamic>
	    		<isNotNull property="searchType" prepend="and">
	  				<isEqual property="searchType" compareValue="uid">
	  					c.mail_uid like #keyWord#
	  				</isEqual>
  				</isNotNull>
	    	</dynamic>
	    
	    limit #maxResult# offset #skipResult#
	</select>
	
	<select id="getSharedAddressBookReaderCount" resultClass="int" parameterClass="Map">
	    SELECT
	    	count(a.mail_user_seq)	
	    FROM adr_shared_reader a, mail_user_info b, mail_user c, mail_domain d
	    WHERE 
	    	a.mail_user_seq = b.mail_user_seq
	    	and a.mail_user_seq = c.mail_user_seq
	    	and c.mail_domain_seq = d.mail_domain_seq
	    	and a.adrbook_seq=cast(#bookSeq# as INT)
	    	and c.mail_uid =#email#
	</select>
  	
  	<insert id="insertAddressBookReader" parameterClass="addrbookReader">
		insert into adr_shared_reader 
		(
			adrbook_seq, mail_user_seq, description 
		) values 
		(
			cast(#addrbookSeq# as INT) ,cast(#userSeq# as INT), cast(#description# as INT)
		)
	</insert>
	
	<delete id="deleteAddressBookReaders" parameterClass="int" >
		DELETE FROM adr_shared_reader WHERE adrbook_seq = ?
	</delete>
	
	<delete id="deleteAddressBookReader" parameterClass="Map" >
		DELETE FROM adr_shared_reader 
		WHERE 
			ADRBOOK_SEQ = cast(#bookSeq# as INT)
	      	and mail_user_seq = cast(#memberSeq# as INT)
	</delete>
	
	<insert id="insertAddressBookModerator" parameterClass="addrbookModerator">
		insert into adr_shared_moderator 
		(
			adrbook_seq, mail_user_seq, description 
		) 
			values (cast(#addrbookSeq# as INT), cast(#userSeq# as INT), #description#)
  	</insert>
  
	<delete id="deleteAddressBookModerators" parameterClass="int" >
		DELETE FROM adr_shared_Moderator WHERE adrbook_seq = ?
	</delete>
	
	<delete id="deleteAddressBookModerator" parameterClass="Map" >
		DELETE FROM adr_shared_Moderator 
		WHERE 
			ADRBOOK_SEQ = cast(#bookSeq# as INT)
	      	and mail_user_seq = cast(#memberSeq# as INT)
	</delete>
	
	<select id="getSharedAddressBookModeratorListCount" resultClass="int" parameterClass="Map">
	    SELECT
	    	count(a.mail_user_seq)    	
	    FROM adr_shared_moderator a, mail_user_info b, mail_user c
	    WHERE 
	    	a.mail_user_seq = b.mail_user_seq
	    	and a.mail_user_seq = c.mail_user_seq
	    	and a.adrbook_seq = cast(#bookSeq# as INT)
	    	<dynamic>
	    		<isNotNull property="searchType" prepend="and">
	  				<isEqual property="searchType" compareValue="uid">
	  					c.mail_uid like #keyWord#
	  				</isEqual>
  				</isNotNull>
	    	</dynamic>
	</select>
	
	<select id="getSharedAddressBookModeratorList" resultMap="addrbookModeratorResult" parameterClass="Map">
	    SELECT
	    	a.mail_user_seq,
	    	a.adrbook_seq,
	    	b.user_name,
			c.mail_uid || '@' || d.mail_domain as user_email,
	    	a.description    	
	    FROM adr_shared_moderator a, mail_user_info b, mail_user c, mail_domain d
	    WHERE 
	    	a.mail_user_seq = b.mail_user_seq
	    	and a.mail_user_seq = c.mail_user_seq
	    	and c.mail_domain_seq = d.mail_domain_seq
	    	and a.adrbook_seq = cast(#bookSeq# as INT)
	    	<dynamic>
	    		<isNotNull property="searchType" prepend="and">
	  				<isEqual property="searchType" compareValue="uid">
	  					c.mail_uid like #keyWord#
	  				</isEqual>
  				</isNotNull>
	    	</dynamic>
	    
	    limit #maxResult# offset #skipResult#
	</select>
	
	<select id="getSharedAddressBookModeratorCheck" resultClass="int" parameterClass="Map">
	    select sum(aa.cnt)
		from
			(
			select count(a.mail_user_seq) as cnt from adr_shared_moderator a where a.adrbook_seq=cast(#bookSeq# as INT) and a.mail_user_seq=cast(#userSeq# as INT)
			union
			select 1 as cnt from ADR_SHARED_MASTER b where b.adrbook_seq=cast(#bookSeq# as INT) and b.creator_seq=cast(#userSeq# as INT)
			) aa
	</select>
	
	<select id="getSharedAddressBookModeratorCount" resultClass="int" parameterClass="Map">
	    SELECT
	    	count(a.mail_user_seq)	
	    FROM adr_shared_moderator a, mail_user_info b, mail_user c, mail_domain d
	    WHERE 
	    	a.mail_user_seq = b.mail_user_seq
	    	and a.mail_user_seq = c.mail_user_seq
	    	and c.mail_domain_seq = d.mail_domain_seq
	    	and a.adrbook_seq=cast(#bookSeq# as INT)
	    	and c.mail_uid=#email#
	</select>
	
	<select id="getPrivateSearchMember" resultMap="searchMemberResult" parameterClass="Map">
		SELECT
			   a.adrbook_seq,
		       a.member_seq, a.member_name, a.member_email, a.company_name,a.department_name, 
		       a.title_name, a.mobile_no, a.home_tel, a.office_tel
		FROM 
			(
		
				SELECT
					   0 as adrbook_seq, 
				       a.member_seq, a.member_name, a.member_email, a.company_name,a.department_name, 
				       a.title_name, a.mobile_no, a.home_tel, a.office_tel
				<isEqual property="groupSeq" compareValue="0">
					FROM adr_private_member a
				</isEqual>
				<isNotEqual property="groupSeq" compareValue="0">			
					FROM adr_private_member a, adr_private_group_member b
				</isNotEqual>
				WHERE 
					a.mail_user_seq=cast(#userSeq# as INT)
					<isNotEqual property="groupSeq" compareValue="0">					    
						and a.member_seq = b.member_seq
						and b.group_seq = cast(#groupSeq# as INT)
					</isNotEqual>
					and (delete_flag is null or delete_flag='' )
					 <dynamic prepend="" >
					 	<isNotNull property="fname" >
					 		and member_name like #fname#
					 	</isNotNull>
					 	<isNotNull property="email" >
					 		and member_email like #email#
					 	</isNotNull>
					 	<isNotNull property="mobile" >
					 		and mobile_no like #mobile#
					 	</isNotNull>
					 	<isNotNull property="company" >
					 		and company_name like #company#
					 	</isNotNull>
					 	<isNotNull property="tel" >
					 		 and (a.home_tel like  #tel# or a.office_tel like  #tel#)
					 	</isNotNull>
					 	<isNotNull property="fnameOrEmail" >
					 		and (member_name like #fnameOrEmail# or member_email like #fnameOrEmail#)
					 	</isNotNull>
					 	<isNotNull property="all" >
					 		and (
					 			member_name like #all# or 
					 			member_email like #all# or
					 			mobile_no like #all# or
					 			home_tel like #all# or
					 			office_tel like #all#
					 			)
					 	</isNotNull>
					 	
					 	<include refid="getPrivateAddress_Where_Clause" />
					 </dynamic>
						
				) a
				<include refid="getPrivateAddress_Order_Clause" />
				
				limit #maxResult# offset #skipResult#
	</select>
	
	<select id="getSharedSearchMember" resultMap="searchMemberResult" parameterClass="Map">
		SELECT
			   a.adrbook_seq,
		       a.member_seq, a.member_name, a.member_email, a.company_name,a.department_name, 
		       a.title_name, a.mobile_no, a.home_tel, a.office_tel
		FROM 
			(
		
				SELECT
					 a.adrbook_seq,
					 a.member_seq, a.member_name, a.member_email, a.company_name,a.department_name, 
					 a.title_name, a.mobile_no, a.home_tel, a.office_tel
				<isEqual property="groupSeq" compareValue="0">
					FROM adr_shared_member a
				</isEqual>
				<isNotEqual property="groupSeq" compareValue="0">			
					FROM adr_shared_member a, adr_shared_group_member b
				</isNotEqual>
				WHERE 
					a.adrbook_seq = cast(#bookSeq# as INT)
					<isNotEqual property="groupSeq" compareValue="0">
					    and a.adrbook_seq = b.adrbook_seq					    
						and a.member_seq = b.member_seq
						and b.group_seq = cast(#groupSeq# as INT)
					</isNotEqual> 
					<dynamic prepend="" >
					 	<isNotNull property="fname" >
					 		and a.member_name like #fname#
					 	</isNotNull>
					 	<isNotNull property="email" >
					 		and a.member_email like #email#
					 	</isNotNull>
					 	<isNotNull property="mobile" >
					 		and a.mobile_no like #mobile#
					 	</isNotNull>
					 	<isNotNull property="company" >
					 		and a.company_name like #company#
					 	</isNotNull>
					 	<isNotNull property="tel" >
					 		 and (a.home_tel like  #tel# or a.office_tel like  #tel#)
					 	</isNotNull>
					 	<isNotNull property="fnameOrEmail" >
					 		and (a.member_name like #fnameOrEmail# or a.member_email like #fnameOrEmail#)
					 	</isNotNull>
					 	<isNotNull property="all" >
					 		and (
					 			member_name like #all# or 
					 			member_email like #all# or
					 			mobile_no like #all# or
					 			home_tel like #all# or
					 			office_tel like #all#
					 			)
					 	</isNotNull>
					 	
					 	<include refid="getPrivateAddress_Where_Clause" />
					 </dynamic>
				) a
				<include refid="getPrivateAddress_Order_Clause" />
				
				limit #maxResult# offset #skipResult#
	</select>
	
	<select id="getAllSearchMember" resultMap="searchMemberResult" parameterClass="Map">
		SELECT
			   a.adrbook_seq,
		       a.member_seq, a.member_name, a.member_email, a.company_name,a.department_name, 
		       a.title_name, a.mobile_no, a.home_tel, a.office_tel
		FROM 
			(
		
				SELECT
					   0 as adrbook_seq, 
				       a.member_seq, a.member_name, a.member_email, a.company_name,a.department_name, 
				       a.title_name, a.mobile_no, a.home_tel, a.office_tel
				FROM adr_private_member a
				WHERE 
					a.mail_user_seq=cast(#userSeq# as INT)
					 <dynamic prepend="" >
					 	<isNotNull property="fname" >
					 		and member_name like #fname#
					 	</isNotNull>
					 	<isNotNull property="email" >
					 		and member_email like #email#
					 	</isNotNull>
					 	<isNotNull property="mobile" >
					 		and mobile_no like #mobile#
					 	</isNotNull>
					 	<isNotNull property="company" >
					 		and company_name like #company#
					 	</isNotNull>
					 	<isNotNull property="tel" >
					 		and home_tel like #tel#
					 	</isNotNull>
					 	<isNotNull property="tel" >
					 		and office_tel like #tel#
					 	</isNotNull>
					 	
					 	<include refid="getPrivateAddress_Where_Clause" />
					 </dynamic>
						
				union	
						
				SELECT
					 a.adrbook_seq,
					 a.member_seq, a.member_name, a.member_email, a.company_name,a.department_name, 
					 a.title_name, a.mobile_no, a.home_tel, a.office_tel
				FROM 
					adr_shared_member a, 
					(
						select a.adrbook_seq from adr_shared_reader a
						union
						select a.adrbook_seq from adr_shared_moderator a
						union 
						select a.adrbook_seq from adr_shared_master a where reader_type='A'
					) b
				WHERE 
					a.adrbook_seq=b.adrbook_seq
					<dynamic prepend="" >
					 	<isNotNull property="fname" >
					 		and member_name like #fname#
					 	</isNotNull>
					 	<isNotNull property="email" >
					 		and member_email like #email#
					 	</isNotNull>
					 	<isNotNull property="mobile" >
					 		and mobile_no like #mobile#
					 	</isNotNull>
					 	<isNotNull property="company" >
					 		and company_name like #company#
					 	</isNotNull>
					 	<isNotNull property="tel" >
					 		and home_tel like #tel#
					 	</isNotNull>
					 	<isNotNull property="tel" >
					 		and office_tel like #tel#
					 	</isNotNull>
					 	
					 	<include refid="getPrivateAddress_Where_Clause" />
					 </dynamic>
				) a
				<include refid="getPrivateAddress_Order_Clause" />
				
				limit #maxResult# offset #skipResult#
	</select>
	
	<select id="getPrivateSearchMemberCount" resultClass="int" parameterClass="Map">
		select sum(cnt) as cnt
		from
			(
				SELECT
				       count(a.member_seq) as cnt
				<isEqual property="groupSeq" compareValue="0">
					FROM adr_private_member a
				</isEqual>
				<isNotEqual property="groupSeq" compareValue="0">			
					FROM adr_private_member a, adr_private_group_member b
				</isNotEqual>
				WHERE 
					a.mail_user_seq=cast(#userSeq# as INT)
					<isNotEqual property="groupSeq" compareValue="0">					    
						and a.member_seq = b.member_seq
						and b.group_seq = cast(#groupSeq# as INT)
					</isNotEqual>
					and (delete_flag is null or delete_flag='' )
					 <dynamic prepend="" >
					 	<isNotNull property="fname" >
					 		and member_name like #fname#
					 	</isNotNull>
					 	<isNotNull property="email" >
					 		and member_email like #email#
					 	</isNotNull>
					 	<isNotNull property="mobile" >
					 		and mobile_no like #mobile#
					 	</isNotNull>
					 	<isNotNull property="company" >
					 		and company_name like #company#
					 	</isNotNull>
					 	<isNotNull property="tel" >
					 		and home_tel like #tel#
					 	</isNotNull>
					 	<isNotNull property="tel" >
					 		and office_tel like #tel#
					 	</isNotNull>
					 	<isNotNull property="fnameOrEmail" >
					 		and (member_name like #fnameOrEmail# or member_email like #fnameOrEmail#)
					 	</isNotNull>
					 	<isNotNull property="all" >
					 		and (
					 			member_name like #all# or 
					 			member_email like #all# or
					 			mobile_no like #all# or
					 			home_tel like #all# or
					 			office_tel like #all#
					 			)
					 	</isNotNull>
					 	
					 	<include refid="getPrivateAddress_Where_Clause" />
					 </dynamic>
			) a
		
	</select>
	
	<select id="getSharedSearchMemberCount" resultClass="int" parameterClass="Map">
		select sum(cnt) as cnt
		from
			(
				SELECT
					 count(a.member_seq) as cnt
				<isEqual property="groupSeq" compareValue="0">
					FROM adr_shared_member a
				</isEqual>
				<isNotEqual property="groupSeq" compareValue="0">			
					FROM adr_shared_member a, adr_shared_group_member b
				</isNotEqual>
				WHERE
					a.adrbook_seq = cast(#bookSeq# as INT) 
					<isNotEqual property="groupSeq" compareValue="0">
					    and a.adrbook_seq = b.adrbook_seq					    
						and a.member_seq = b.member_seq
						and b.group_seq = cast(#groupSeq# as INT)
					</isNotEqual> 
					<dynamic prepend="" >
					 	<isNotNull property="fname" >
					 		and a.member_name like #fname#
					 	</isNotNull>
					 	<isNotNull property="email" >
					 		and a.member_email like #email#
					 	</isNotNull>
					 	<isNotNull property="mobile" >
					 		and a.mobile_no like #mobile#
					 	</isNotNull>
					 	<isNotNull property="company" >
					 		and a.company_name like #company#
					 	</isNotNull>
					 	<isNotNull property="tel" >
					 		and a.home_tel like #tel#
					 	</isNotNull>
					 	<isNotNull property="tel" >
					 		and a.office_tel like #tel#
					 	</isNotNull>
					 	<isNotNull property="fnameOrEmail" >
					 		and (a.member_name like #fnameOrEmail# or a.member_email like #fnameOrEmail#)
					 	</isNotNull>
					 	<isNotNull property="all" >
					 		and (
					 			member_name like #all# or 
					 			member_email like #all# or
					 			mobile_no like #all# or
					 			home_tel like #all# or
					 			office_tel like #all#
					 			)
					 	</isNotNull>
					 	
					 	<include refid="getPrivateAddress_Where_Clause" />
					 </dynamic>
			) a
		
	</select>
	
	<select id="getAllSearchMemberCount" resultClass="int" parameterClass="Map">
		select sum(cnt) as cnt
		from
			(
				SELECT
				       count(a.member_seq) as cnt
				FROM adr_private_member a
				WHERE 
					a.mail_user_seq=cast(#userSeq# as INT)
					 <dynamic prepend="" >
					 	<isNotNull property="fname" >
					 		and member_name like #fname#
					 	</isNotNull>
					 	<isNotNull property="email" >
					 		and member_email like #email#
					 	</isNotNull>
					 	<isNotNull property="mobile" >
					 		and mobile_no like #mobile#
					 	</isNotNull>
					 	<isNotNull property="company" >
					 		and company_name like #company#
					 	</isNotNull>
					 	<isNotNull property="tel" >
					 		and home_tel like #tel#
					 	</isNotNull>
					 	<isNotNull property="tel" >
					 		and office_tel like #tel#
					 	</isNotNull>
					 	
					 	<include refid="getPrivateAddress_Where_Clause" />
					 </dynamic>
						
				union	
						
				SELECT
					 count(a.member_seq) as cnt
				FROM 
					adr_shared_member a, 
					(
						select a.adrbook_seq from adr_shared_reader a
						union
						select a.adrbook_seq from adr_shared_moderator a
						union
						select a.adrbook_seq from adr_shared_master a where reader_type='A'
					) b
				WHERE 
					a.adrbook_seq=b.adrbook_seq
					<dynamic prepend="" >
					 	<isNotNull property="fname" >
					 		and member_name like #fname#
					 	</isNotNull>
					 	<isNotNull property="email" >
					 		and member_email like #email#
					 	</isNotNull>
					 	<isNotNull property="mobile" >
					 		and mobile_no like #mobile#
					 	</isNotNull>
					 	<isNotNull property="company" >
					 		and company_name like #company#
					 	</isNotNull>
					 	<isNotNull property="tel" >
					 		and home_tel like #tel#
					 	</isNotNull>
					 	<isNotNull property="tel" >
					 		and office_tel like #tel#
					 	</isNotNull>
					 	
					 	<include refid="getPrivateAddress_Where_Clause" />
					 </dynamic>
			) a
		
	</select>
	
	<select id="selectAddressEnv" resultMap="addrEnvResult" parameterClass="int" >
    	select 
    		MAIL_DOMAIN_SEQ, PRIVATE_ADR_MAX_MEMBER, PRIVATE_ADR_MAX_GROUP, SHARED_ADR_CREATOR_TYPE,
      		SHARED_ADR_MAX_ADR, SHARED_ADR_MAX_MEMBER, SHARED_ADR_MAX_GROUP
    	from ADR_CONFIG
    	where 
    		MAIL_DOMAIN_SEQ = cast(#value# as INT)
	</select>
	
	<select id="getCreatorListCount" resultClass="int" parameterClass="Map" >
    	select 
    		count(a.mail_user_seq)
    	from 
    		ADR_SHARED_CREATOR a
    	where 
    		a.mail_user_seq= cast(#userSeq# as INT)
	</select>
	
	<select id="readBookReaderType" parameterClass="int"  resultClass="String">
    	select 
    		reader_type
    	from 
			ADR_SHARED_MASTER
    	where 
    		adrbook_seq = cast(#value# as INT)
	</select>
	
	<select id="getPrivateAddressEmailList" resultClass="address" parameterClass="Map">
	
	   SELECT
	      a.member_name as name, a.member_email as email
	    FROM adr_private_member a, adr_private_group_member b, adr_private_group c
	    WHERE 
	    	a.member_seq = b.member_seq
	    	and a.mail_user_seq = b.mail_user_seq
	    	and a.mail_user_seq = c.mail_user_seq
	    	and b.group_seq = c.group_seq
	    	and c.group_name = #groupName#
	    	and a.mail_user_seq= cast(#userSeq# as INT)
	</select>
	
	<select id="getSharedAddressEmailList" resultClass="address" parameterClass="Map">
	
	   SELECT
	      a.member_name as name, a.member_email as email
	    FROM adr_shared_member a, adr_shared_group_member b, adr_shared_group c
	    WHERE 
	    	a.member_seq = b.member_seq
	    	and a.adrbook_seq = b.adrbook_seq
	    	and b.group_seq = c.group_seq
	    	and c.group_name = #groupName# 
	    	and a.adrbook_seq= cast(#bookSeq# as INT)
	</select>
	
	<select id="getAddressBookAuth" resultMap="addrAuthResult" parameterClass="Map">
	<![CDATA[
   		SELECT 
	    	'addr_env' as attr_name , shared_adr_creator_type as attr_value 
	    FROM adr_config where mail_domain_seq=cast(#domainSeq# as INT)
		
		union all
		
		SELECT 
			'creator_auth' as attr_name, case when count(r.mail_user_seq) <1 then 'N' else 'Y' end as attr_value  
		FROM ADR_SHARED_CREATOR r where r.mail_user_seq=cast(#userSeq# as INT)
		
		union all
		
		SELECT 
			'read_auth' as attr_name, case when count(r.mail_user_seq) <1 then 'N' else 'Y' end as attr_value  
		FROM adr_shared_reader r where r.adrbook_seq=cast(#bookSeq# as INT) and r.mail_user_seq=cast(#userSeq# as INT)
		
		union all
		
		SELECT 
			'write_auth' as attr_name, case when count(r.mail_user_seq) <1 then 'N' else 'Y' end as attr_value  
		FROM adr_shared_moderator r where r.adrbook_seq=cast(#bookSeq# as INT) and r.mail_user_seq=cast(#userSeq# as INT)
		
		union all
		
		SELECT 
			'book_auth' as attr_name, case when count(t.creator_seq) <1 then 'N' else 'Y' end as attr_value  
		FROM adr_shared_master t where t.adrbook_seq=cast(#bookSeq# as INT) and t.creator_seq=cast(#userSeq# as INT)
		
		union all

		SELECT 
			'reader_type' as attr_name,  reader_type as attr_value 
		FROM adr_shared_master where mail_domain_seq=cast(#domainSeq# as INT) and adrbook_seq=cast(#bookSeq# as INT)
   		
   	]]>
	    
	</select>
	
	<select id="findPrivateAddressGroup" resultClass="group" parameterClass="Map">
	    SELECT
	      group_seq as groupSeq,
	      group_name as groupName
	    FROM adr_private_group
    	WHERE 
    		mail_user_seq = cast(#userSeq# as INT)
    		and group_name=#groupName#
	</select>
	
	<select id="findSharedAddressGroup" resultClass="group" parameterClass="Map">
	    SELECT
	      group_seq as groupSeq,
	      group_name as groupName
	    FROM adr_shared_group
    	WHERE 
    		ADRBOOK_SEQ =cast(#bookSeq# as INT)
    		and group_name=#groupName#
	</select>
	
	<select id="getSharedAddressMemberCount" resultClass="int" parameterClass="Map">
	    SELECT
	      count(member_seq)
	    FROM adr_shared_group_member
	    WHERE 
	    	adrbook_seq= cast(#bookSeq# as INT)
	    	and group_seq = cast(#groupSeq# as INT)
	    	and member_seq= cast(#memberSeq# as INT)
	</select>
	
	<select id="getSharedAddressBookCount" resultClass="int" parameterClass="int">
	    SELECT
	      count(adrbook_seq)
	    FROM adr_shared_master
	    WHERE 
	    	mail_domain_seq= cast(#domainSeq# as INT)
	</select>
	
	<select id="getPrivateGroup" parameterClass="Map" resultClass="group">
	    SELECT
	      group_seq as groupSeq,
	      group_name as groupName
	    FROM adr_private_group
	    WHERE 
	    	mail_user_seq =cast(#userSeq# as INT)
	    	and group_seq = cast(#groupSeq# as INT)
	</select>
	
	<select id="getSharedBook" resultMap="addrbookWithAuthResult" parameterClass="map">
		SELECT 
			a.adrbook_seq,
			a.mail_domain_seq,
			a.adrbook_name,    	
			a.reader_type,
			a.description,
			a.creator_seq,
			b.user_name,
			(select count(r.mail_user_seq) from adr_shared_reader r where r.adrbook_seq=a.adrbook_seq and r.mail_user_seq=cast(#userSeq# as INT)) as readAuth,
			(select count(w.mail_user_seq) from adr_shared_moderator w where w.adrbook_seq=a.adrbook_seq and w.mail_user_seq=cast(#userSeq# as INT)) as writeAuth
		FROM 
			ADR_SHARED_MASTER a, mail_user_info b
		where 
			a.CREATOR_SEQ = b.mail_user_seq
			and a.mail_domain_seq=cast(#domainSeq# as INT)
			and a.adrbook_seq 	=cast(#bookSeq# as INT)
			 
  	</select>
  	
  	<select id="getPrivateMemberByClientId" resultClass="int" parameterClass="map">
    	SELECT
     	 member_seq
   		FROM adr_private_member
    	WHERE 
    		mail_user_seq=cast(#userSeq# as INT)
    		and client_id = #clientId#
  	</select>
  	
  	<select id="getPrivateAddressListCountByDate" resultClass="int" parameterClass="Map">
	    SELECT
	      count(a.*)
	    FROM adr_private_member a
	    WHERE 
	    	a.member_seq=b.member_seq
	    	and a.mail_user_seq=cast(#user# as INT) 
	    	and a.tm_time <![CDATA[ > ]]> #fromDate#
	    	
	    	limit #maxResult# offset #skipResult#
	</select>
	
	<select id="getAddPrivateAddressListByDate" resultMap="addrbookMemberResult" parameterClass="Map">
	    SELECT
	      a.*
	    FROM adr_private_member a
	    WHERE 
	    	a.mail_user_seq=cast(#user# as INT) 
	    	and a.add_time <![CDATA[ > ]]> #fromDate#
	    	
	    	limit #maxResult# offset #skipResult#
	</select>
	
	<select id="getModPrivateAddressListByDate" resultMap="addrbookMemberResult" parameterClass="Map">
	    SELECT
	      a.*
	    FROM adr_private_member a
	    WHERE 
	    	a.mail_user_seq=cast(#user# as INT) 
	    	and a.mod_time <![CDATA[ > ]]> #fromDate#
	    	
	    	limit #maxResult# offset #skipResult#
	</select>
	
	<select id="getDelPrivateAddressListByDate" resultMap="addrbookMemberResult" parameterClass="Map">
	    SELECT
	      a.*
	    FROM adr_private_member a
	    WHERE 
	    	a.mail_user_seq=cast(#user# as INT)
	    	and a.delete_flag='Y' 
	    	and a.del_time <![CDATA[ > ]]> #fromDate#
	    	
	    	limit #maxResult# offset #skipResult#
	</select>
	
	<select id="getOrgMember" resultMap="addrbookMemberResult2" parameterClass="Map" >
    	select 
    		c.user_name as member_name,
			b.mail_uid || '@' || d.mail_domain as member_email,
    		c.first_name as first_name,
    		c.middle_name as MIDDLE_NAME,
    		c.last_name as LAST_NAME,    		
    		c.private_homepage as PRIVATE_HOMEPAGE,
    		c.office_homepage as OFFICE_HOMEPAGE,
    		c.birthday as BIRTH_DAY,    		
    		c.mobile_no as MOBILE_NO,
    		c.home_tel as HOME_TEL,
    		c.home_fax as HOME_FAX,
    		c.home_postal_code as HOME_POSTAL_CODE,
    		c.home_country as HOME_COUNTRY,
    		c.home_state as HOME_STATE,
    		c.home_city as HOME_CITY,
    		c.home_street as HOME_STREET,    		
    		c.home_ext_address as HOME_EXT_ADDRESS,
    		c.company_name as COMPANY_NAME,
    		<dynamic prepend="">
    			<isEqual property="locale" compareValue="ko">
    				e.org_name as DEPARTMENT_NAME,
    			</isEqual>
    			<isEqual property="locale" compareValue="en">
    				e.org_name_en as DEPARTMENT_NAME,
    			</isEqual>
    			<isEqual property="locale" compareValue="jp">
    				e.org_name_jp as DEPARTMENT_NAME,
    			</isEqual>
    		</dynamic>
    		(
    			select cc.code_name from tdomain_code cc, tdomain_code_class dd 
    			where 
    				cc.mail_domain_seq=dd.mail_domain_seq 	
    				and cc.code_class=dd.code_class 
    				and cc.code_class='101' 
    				and cc.mail_domain_seq=cast(#mailDomain# as INT)
    				and cc.code_locale=#locale#
    				and cc.code= a.title_code
    		) as TITLE_NAME,
    		c.office_tel as OFFICE_TEL,
    		c.office_fax as OFFICE_FAX,
    		c.office_postal_code as OFFICE_POSTAL_CODE,
    		c.office_country as OFFICE_COUNTRY,
    		c.office_state as OFFICE_STATE,
    		c.office_city as OFFICE_CITY,
    		c.office_street as OFFICE_STREET,
    		c.office_basic_address as OFFICE_BASIC_ADDRESS,
    		c.office_ext_address as OFFICE_EXT_ADDRESS
    	from TORG_MEMBER a, mail_user b, mail_user_info c, mail_domain d, TORG_ORGANIZATION e
    	where 
	    	a.mail_user_seq=b.mail_user_seq
	    	and b.mail_user_seq=c.mail_user_seq
	    	and b.mail_domain_seq = d.mail_domain_seq
	    	and b.mail_domain_seq = e.mail_domain_seq
	    	and a.org_code=e.org_code
    		and a.MAIL_DOMAIN_SEQ = cast(#mailDomain# as INT)
    		and a.mail_user_seq = cast(#userSeq# as INT)
    		and a.org_code=#orgCode#
  	</select>
  	
  	<select id="getPrivateAddressAllList" resultMap="searchMemberResult" parameterClass="Map">
  		select 0 as adrbook_seq, a.* from 
		(select * from adr_private_member where mail_user_seq = cast(#userSeq# as INT)) a
		left outer join
		(select * from adr_private_group_member where mail_user_seq = cast(#userSeq# as INT)) b
		on a.member_seq = b.member_seq
    	<dynamic prepend="where">
    		<isNotEqual property="groupSeq" compareValue="0">
    			b.group_seq = cast(#groupSeq# as INT) and
    		</isNotEqual>
    		<isParameterPresent >
    		  (delete_flag is null or delete_flag='' )
		      <include refid="getPrivateAddress_Where_Clause" />
		      <include refid="getPrivateAddress_Order_Clause" />
		    </isParameterPresent>
    	</dynamic>
	</select>
	
	<select id="getShareAddressAllList" resultMap="searchMemberResult" parameterClass="Map">
    	select a.* from 
    	(select * from adr_shared_member where adrbook_seq = cast(#bookSeq# as INT)) a
    	left outer join
    	(select * from adr_shared_group_member where adrbook_seq = cast(#bookSeq# as INT)) b
    	on a.member_seq = b.member_seq
    	<dynamic prepend="where">
    		<isNotEqual property="groupSeq" compareValue="0">
    			b.group_seq = cast(#groupSeq# as INT) and
    		</isNotEqual>
    		<isParameterPresent >
    			1=1
		      <include refid="getPrivateAddress_Where_Clause" />
		      <include refid="getPrivateAddress_Order_Clause" />
		    </isParameterPresent>
    	</dynamic>
	</select>
	<select id="readExistEmail" resultMap="addrbookMemberResult" parameterClass="Map">
    
        SELECT * FROM adr_private_member WHERE mail_user_seq=cast(#userSeq# as INT) AND member_email=#email# AND member_name=#name#
    
    </select>
</sqlMap>
