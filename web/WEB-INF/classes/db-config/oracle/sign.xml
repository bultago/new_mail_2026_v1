<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Sign">

	<select id="getSign" resultMap="signResult" parameterClass="int" cacheModel="signCache">
    	select mail_user_seq, sign_apply, sign_location from wcf_sign where mail_user_seq = #value#
  	</select>
	
	<insert id="insertSign" parameterClass="sign" >
		insert into wcf_sign (mail_user_seq, sign_apply, sign_location)
		values (#mailUserSeq#, #signApply#, #signLocation#)
	</insert>
	
	<update id="updateSign" parameterClass="sign" >
    	update wcf_sign
    	<dynamic prepend=" SET ">
    		<isNotNull property="signApply" prepend=",">
   				sign_apply = #signApply#
   			</isNotNull>
   			<isNotNull property="signLocation" prepend=",">
   			sign_location = #signLocation#
   			</isNotNull>
    	</dynamic>
    	where mail_user_seq = #mailUserSeq#
  	</update>
	
	<delete id="deleteSign" parameterClass="sign" >
    	delete from wcf_sign where mail_user_seq = #mailUserSeq#
  	</delete>
	
	<insert id="insertSignData" parameterClass="signData">
		<selectKey resultClass="int" keyProperty="signSeq">
			select case when max(sign_seq) is null then 1 else max(sign_seq)+1 end
			from wcf_sign_data where mail_user_seq = #userSeq#
		</selectKey>
		insert into wcf_sign_data 
		<dynamic prepend=" " open="( " close=" )">
			<isGreaterThan property="signSeq" compareValue="0" prepend=",">
				sign_seq
			</isGreaterThan>
			<isGreaterThan property="userSeq" compareValue="0" prepend=",">
				mail_user_seq
			</isGreaterThan>
			<isNotNull property="defaultSign" prepend=",">
				default_sign
			</isNotNull>
			<isNotNull property="signName" prepend=",">
				sign_name
			</isNotNull>
			<isNotNull property="signText" prepend=",">
				sign_text
			</isNotNull>
			<isNotNull property="signImage" prepend=",">
				sign_img
			</isNotNull>
			<isNotNull property="signMode" prepend=",">
				sign_mode
			</isNotNull>
			<isNotNull property="signImageName" prepend=",">
				sign_img_name
			</isNotNull>
		</dynamic>
		<dynamic prepend="values " open="( " close=" )">
			<isGreaterThan property="signSeq" compareValue="0" prepend=",">
				#signSeq#
			</isGreaterThan>
			<isGreaterThan property="userSeq" compareValue="0" prepend=",">
				#userSeq#
			</isGreaterThan>
			<isNotNull property="defaultSign" prepend=",">
				#defaultSign#
			</isNotNull>
			<isNotNull property="signName" prepend=",">
				#signName#
			</isNotNull>
			<isNotNull property="signText" prepend=",">
				#signText#
			</isNotNull>
			<isNotNull property="signImage" prepend=",">
				#signImage#
			</isNotNull>
			<isNotNull property="signMode" prepend=",">
				#signMode#
			</isNotNull>
			<isNotNull property="signImageName" prepend=",">
				#signImageName#
			</isNotNull>
		</dynamic>
	</insert>
	
	<select id="getSignDataList" resultMap="signDataResult" parameterClass="int">
    	SELECT
      		sign_seq, mail_user_seq, default_sign, sign_name, sign_text, sign_img, sign_mode, sign_img_name
    	FROM wcf_sign_data
    	WHERE 
    		mail_user_seq=#value#
  	</select>
  	
  	<select id="getSignSimpleDataList" resultMap="signSimpleDataResult" parameterClass="int">
    	SELECT
      		sign_seq, default_sign, sign_name
    	FROM wcf_sign_data
    	WHERE 
    		mail_user_seq=#value#
  	</select>
  	
  	<select id="readSignData" parameterClass="map" resultMap="signDataResult">
  		SELECT
      		sign_seq, mail_user_seq, default_sign, sign_name, sign_text, sign_img, sign_mode, sign_img_name
    	FROM wcf_sign_data
    	WHERE 
    		mail_user_seq=#userSeq# and sign_seq=#signSeq#
  	</select>
	
	<delete id="deleteSignData" parameterClass="map" >
		DELETE FROM wcf_sign_data WHERE mail_user_seq = #userSeq#
		
		<dynamic>
			<isNotNull property="signSeqs">
				<iterate property="signSeqs"
					prepend="and sign_seq"
					open=" in ("
					conjunction=","
					close=")"
				>
					#signSeqs[]#
				</iterate>
			</isNotNull>
		</dynamic>
	</delete>
	
	<update id="updateSignData" parameterClass="signData" >
		UPDATE wcf_sign_data
  		<dynamic prepend=" SET ">
  			<isPropertyAvailable property="signName" prepend=",">
  				sign_name= #signName:VARCHAR#
  			</isPropertyAvailable>
  			<isPropertyAvailable property="signText" prepend=",">
  				default_sign= #defaultSign:CHAR#
  			</isPropertyAvailable>
  			<isPropertyAvailable property="signText" prepend=",">
  				sign_text= #signText:LONG#
  			</isPropertyAvailable>
  			<isNotNull property="signImage" prepend=",">
  				sign_img= #signImage:BLOB#
  			</isNotNull>
  			<isPropertyAvailable property="signMode" prepend=",">
  				sign_mode= #signMode:VARCHAR#
  			</isPropertyAvailable>
  			<isNotNull property="signImageName" prepend=",">
  				sign_img_name= #signImageName:VARCHAR#
  			</isNotNull>
  		</dynamic>
  		WHERE 
  			mail_user_seq=#userSeq# and sign_seq=#signSeq#
	</update>
	
	<select id="getDefaultSignData" resultMap="signDataResult" parameterClass="int">
    	SELECT
      		sign_seq, mail_user_seq, default_sign, sign_name, sign_text, sign_img, sign_mode, sign_img_name
    	FROM wcf_sign_data
    	WHERE 
    		mail_user_seq=#value#
    		AND default_sign='T'
  	</select>
  	
  	<update id="updateCheckAllNotDefault" parameterClass="int">
  		update wcf_sign_data set default_sign = 'F' where mail_user_seq = #value#
  	</update>
  
</sqlMap>