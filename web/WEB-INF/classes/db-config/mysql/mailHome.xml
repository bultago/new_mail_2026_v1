<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.terracetech.tims.webmail.Home.mapper.HomeMapper">

	<select id="selectMailHomePortlet" resultMap="portletResult" parameterType="String" >
    	select 
    		PORTLET_SEQ, PORTLET_NAME, PORTLET_URL, DESCRIPTION
    	from WEBMAIL_HOME_PORTLET
    	where 
    		PORTLET_NAME = #{name}
    		and mail_domain_seq=#{domainSeq}
	</select>

	<select id="selectMailHomePortlets" resultMap="portletResult" parameterType="int" >
    	select 
    		PORTLET_SEQ, PORTLET_NAME, PORTLET_URL, DESCRIPTION
    	from WEBMAIL_HOME_PORTLET where mail_domain_seq=#{value}
	</select>
  
	<select id="selectMailHomeLayout" parameterType="int" resultMap="layoutResult">
    	select 
    		LAYOUT_SEQ, LAYOUT_NAME, LAYOUT_USE, PORTLET_COUNT
    	from WEBMAIL_HOME_LAYOUT
	</select>
	
	<insert id="insertLayoutPortlet" parameterType="portlet" >
    	insert into webmail_home_custom 
    		(LAYOUT_SEQ, PORTLET_SEQ, MAIL_USER_SEQ, PORTLET_LOCATION)
    	values 
    		(#{layoutSeq},#{portletSeq}, #{userSeq}, #{location})
	</insert>
	
	<delete id="deleteLayoutPortlet" parameterType="int">
    	delete from webmail_home_custom where MAIL_USER_SEQ = #{value}
	</delete>
	
	<select id="selectMailHomeLayoutPortlet" parameterType="int" resultMap="layoutPortletResult">
    	select 
    		c.*, b.PORTLET_LOCATION
    	from WEBMAIL_HOME_LAYOUT a, webmail_home_custom b, WEBMAIL_HOME_PORTLET c
    	where 
    		b.MAIL_USER_SEQ = #{value}
    		and a.LAYOUT_SEQ = b.LAYOUT_SEQ
    		and b.PORTLET_SEQ = c.PORTLET_SEQ
	</select>
	
	<insert id="insertMailHomeLayout" parameterType="layout" >
    	insert into WEBMAIL_HOME_LAYOUT 
    		(LAYOUT_NAME, portlet_count, LAYOUT_USE)
    	values 
    		(#{layoutName}, #{portletCount}, #{layoutUse})
	</insert>
	
	<delete id="deleteMailHomeLayout" parameterType="int">
    	delete from WEBMAIL_HOME_LAYOUT where MAIL_USER_SEQ = #{value}
	</delete>
	
	<delete id="deleteMailHomePortlet" parameterType="int" >
    	delete from WEBMAIL_HOME_PORTLET where PORTLET_SEQ = #{value}
	</delete>
  
	<insert id="insertMailHomePortlet" parameterType="portlet" >
		<selectKey resultType="int" keyProperty="portletSeq">
			select case when max(portlet_seq) is null then 1 else max(portlet_seq)+1 end
			from WEBMAIL_HOME_PORTLET
		</selectKey>
    	insert into WEBMAIL_HOME_PORTLET 
    		(mail_domain_seq, PORTLET_SEQ, PORTLET_NAME, DEFAULT_PORTLET, PORTLET_URL, DESCRIPTION)
    	values 
    		(#{domainSeq}, #{portletSeq}, #{portletName}, #{defaultPortlet}, #{portletUrl}, #{description})
	</insert>
  
	<update id="updateMailHomePortlet" parameterType="portlet" >
    	update WEBMAIL_HOME_PORTLET
    		set PORTLET_NAME = #{portletName:VARCHAR},
      			PORTLET_URL = #{portletUrl:VARCHAR},
      			DESCRIPTION = #{description:LONGVARCHAR}
    	where PORTLET_SEQ = #{portletSeq:INTEGER}
	</update>
	
	<select id="selectMailMenuList" resultMap="menuResult" parameterType="int"  cacheModel="menuCache">
    	select 
    		menu_seq, menu_id, mail_domain_seq, menu_url, menu_name, menu_target, order_seq, menu_apply
    	from webmail_menu_layout where mail_domain_seq=#{value} and menu_apply='on' order by order_seq asc
	</select>
</mapper>