<project name="TMS7 WEBMAIL - tms746s" default="tar.backup" basedir=".">
	<property file="build.properties" />
	<property file="${user.home}/build.properties" />
	<tstamp>
		<format property="today_date" pattern="yyyyMMdd_HHmmss" locale="en,GB" />
		<format property="today_date_simple" pattern="yyyyMMdd" locale="en,GB" />
	</tstamp>

	<property name="app.name" value="tms746s_webmail" />
	<property name="app.name.simple" value="tms746s" />
	<property name="app.path" value="/${app.name}" />
	<property name="app.version" value="0.1-dev" />
	<property name="merge.home" value="D:/build/TMS746S" />
	<property name="merge.path" value="D:/build" />
	<property name="patch.path" value="D:/patch/${app.name.simple}/tms746s/webmail" />
	<property name="merge.home.source" value="${merge.home}/source" />
	<property name="merge.home.root" value="${merge.home}/ROOT" />
	<property name="build.home" value="${basedir}/ROOT" />
	<property name="build.new" value="${basedir}/build.new" />
	<property name="catalina.home" value="./" />
	<property name="dist.home" value="${basedir}/dist" />
	<property name="docs.home" value="${basedir}/docs" />
	<property name="manager.url" value="http://localhost:8081/manager" />
	<property name="manager.username" value="manager" />
	<property name="manager.password" value="manager" />
	<property name="src.home" value="${basedir}/src" />
	<property name="web.home" value="${basedir}/web" />
	<property name="bin.home" value="${basedir}/bin/classes" />
	<property name="src_default.home" value="D:/workspace/TMS_WEBMAIL_746S_ORIGINAL/src" />
	<property name="web_default.home" value="D:/workspace/TMS_WEBMAIL_746S_ORIGINAL/web" />
	<property name="webconfig.home" value="${web.home}/WEB-INF" />
	<property name="serverlib.home" value="D:/workspace/TMS_WEBMAIL_746S_ORIGINAL" />
	<property name="applib.home" value="${merge.home.root}/WEB-INF/lib" />
	<property name="resources.home" value="${webconfig.home}/classes/messageResources" />
	<property name="js.home" value="${build.home}/js" />

	<!-- ============================= SOLIN CUSTOM BUILD START ========================= -->
	<target name="tar.backup.prepare" depends="js.minify">
		<!-- Create build directories as needed -->
		<mkdir dir="${merge.path}" />
		<mkdir dir="${merge.home}" />
		<mkdir dir="${merge.home.root}" />
		<mkdir dir="${merge.home.root}/WEB-INF" />
		<mkdir dir="${merge.home.root}/WEB-INF/classes" />

		<!-- Copy static content of this web application -->
		<copy todir="${merge.home.root}" overwrite="true">
			<fileset dir="${web.home}">
				<exclude name="js/**" />
			</fileset>
		</copy>

		<copy todir="${merge.home.root}/WEB-INF/classes">
			<fileset dir="${bin.home}" />
		</copy>
	</target>

	<target name="tar.backup.clean">
		<delete dir="${merge.home.root}" />
	</target>
	<target name="tar.backup.load">
		<loadfile srcfile="${merge.path}/tms7_build.txt" property="tar.file.list">
			<filterchain>
				<striplinebreaks />
			</filterchain>
		</loadfile>
		<echo message="File contents is '${tar.file.list}'" />
	</target>
	<target name="tar.backup" depends="tar.backup.clean, tar.backup.prepare, tar.backup.load">
		<echo>Patch File Copy To ${patch.path}</echo>
		<mkdir dir="${patch.path}/${today_date_simple}" />
		<tar destfile="${patch.path}/${today_date_simple}/${app.name}_${today_date}.tar.gz" basedir="${merge.home}" includes="${tar.file.list}" compression="gzip" />

		<echo>Patch file List ${tar.file.list}</echo>
		<exec executable="cmd" dir="${patch.path}/${today_date_simple}" spawn="true">
			<arg value="/c" />
			<arg value="explorer ." />
		</exec>
	</target>

	<target name="tar.backup.test">
		<echo>TEST</echo>
	</target>
	<!-- ============================= SOLIN CUSTOM BUILD END ========================== -->

	<!-- ==================== Compress Target =================================== -->
	<target name="js.minify" description="minifying JS">

		<echo>Delete Exist JS File ...</echo>
		<copy todir="${merge.home.root}/js" overwrite="true">
			<fileset dir="${web.home}/js" />
		</copy>

		<delete>
			<fileset dir="${merge.home.root}/js" includes="**/*-all.min.js" />
		</delete>

		<echo>JS File Mergeing ...(common-lib)</echo>
		<concat destfile="${merge.home.root}/js/common-lib/common-header-all.js" force="no" fixlastline="yes" encoding="UTF-8">
			<filelist dir="${merge.home.root}/js/common-lib" files="common.js,common-base64.js,common-editor.js,validate.js,common-menuLayer.js,common-form.js" />
		</concat>

		<echo>JS File Mergeing ...(core-lib)</echo>
		<concat destfile="${merge.home.root}/js/core-lib/core-all.js" force="no" fixlastline="yes" encoding="UTF-8">
			<filelist dir="${merge.home.root}/js/core-lib" files="jquery-1.3.2.js,prototype.js" />
		</concat>

		<echo>JS File Mergeing ...(ext-header-lib)</echo>
		<concat destfile="${merge.home.root}/js/ext-lib/ext-header-all.js" force="no" fixlastline="yes" encoding="UTF-8">
			<filelist dir="${merge.home.root}/js/ext-lib" files="jquery.ui.js,jcookie.js,jquery.util.js,jquery.history.js,noclick.js" />
		</concat>

		<echo>JS File Mergeing ...(ext-mail-lib)</echo>
		<concat destfile="${merge.home.root}/js/ext-lib/ext-mail-all.js" force="no" fixlastline="yes" encoding="UTF-8">
			<filelist dir="${merge.home.root}/js/ext-lib" files="jquery.colorpicker.js,jquery.dftree.js,jquery.datepick.js,jquery.dynamicPane.js,jquery.form.js,jquery.popup.js,jquery.autocomplete.js,menuToolBar.js,jquery.swfupload.js" />
		</concat>

		<echo>JS File Mergeing ...(mail-lib)</echo>
		<concat destfile="${merge.home.root}/js/mail-lib/mail-all.js" force="no" fixlastline="yes" encoding="UTF-8">
			<fileset dir="${merge.home.root}/js/mail-lib" excludes="mailBasicCommon.js" />
		</concat>

		<echo>JS File Mergeing ...(ocx-lib)</echo>
		<concat destfile="${merge.home.root}/js/ocx/ocx-all.js" force="no" fixlastline="yes" encoding="UTF-8">
			<fileset dir="${merge.home.root}/js/ocx" includes="**/*.js" />
		</concat>

		<echo>JS File Mergeing ...(swf-lib)</echo>
		<concat destfile="${merge.home.root}/js/swfupload-lib/swf-all.js" force="no" fixlastline="yes" encoding="UTF-8">
			<fileset dir="${merge.home.root}/js/swfupload-lib" includes="**/*.js" />
		</concat>

		<echo>JS File Minifying ...</echo>
		<apply executable="java" parallel="false">
			<fileset dir="${merge.home.root}/js" includes="**/*-all.js" />
			<arg line="-jar" />
			<arg path="${web_default.home}/WEB-INF/lib/yuicompressor-2.4.2.jar" />
			<arg line="--type js --nomunge" />
			<arg line="--charset UTF-8" />
			<srcfile />
			<arg line="-o" />
			<mapper type="glob" from="*.js" to="${merge.home.root}/js/*.min.js" />
			<targetfile />
		</apply>

		<echo>Delete Exist JS Temp File ...</echo>
		<delete>
			<fileset dir="${merge.home.root}/js" includes="**/*-all.js" />
		</delete>
	</target>
</project>


